<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>AMR-GraphNet :: Tool</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="./assets/css/site.css">
    <link rel="stylesheet" href="./assets/css/style.css">
    <style>
        /* Basic styling for the graph layout */
        html, body { width:100%; height:100%; margin:0; }
        svg { width: 100%; height: 100%; }
        path.link { stroke-opacity:.6; fill:none; }
        path.node { cursor:grab; }
        text.label { font:12px system-ui; pointer-events:none; }
    </style>
</head>

<body>
<div class="container-fluid">
    <header class="d-flex flex-wrap align-items-center justify-content-center justify-content-md-between py-3 mb-4 border-bottom">
        <a href="index.html" class="d-flex align-items-center col-md-3 mb-2 mb-md-0 text-dark text-decoration-none">
            <img src="assets/img/Logo.svg" alt="AMR-GraphNet Logo" width="35" height="35" class="d-inline-block align-text-middle">
            <span class="fs-4 ms-2"> AMR-GraphNet </span>
        </a>
        <ul class="nav col-12 col-md-auto mb-2 justify-content-center mb-md-0 tool">
            <li><a href="./index.html" class="nav-link px-2 link-dark nav-about">About</a></li>
            <li><a href="./tool.html" class="nav-link px-2 link-dark nav-tool">Tool</a></li>
            <li><a href="./analysis.html" class="nav-link px-2 link-dark nav-analysis">Analysis</a></li>
            <li><a href="./downloads.html" class="nav-link px-2 link-dark nav-downloads">Downloads</a></li>
            <li><a href="./contact.html" class="nav-link px-2 link-dark nav-contact">Contact</a></li>
        </ul>
    </header>

    <div id="menu" class="card p-2 mb-3">
        <div class="row g-3 align-items-end">
            <!-- Graph View Selection -->
            <div class="col-md-4 col-lg-3">
                <label for="dataset" class="form-label"><strong>Graph View</strong></label>
                <select id="dataset" class="form-select">
                    <option value="json/graph1.json">ARG-MGE Interaction View</option>
                    <option value="json/graph2.json">Colocalization View</option>
                </select>
            </div>

            <!-- Disease Filter -->
            <div class="col-md-4 col-lg-2">
                <label for="diseaseFilter" class="form-label"><strong>Disease</strong></label>
                <select id="diseaseFilter" class="form-select">
                    <option value="all" selected>All Diseases</option>
                    <option value="Melanoma">Melanoma</option>
                    <option value="MDRB">MDRB</option>
                    <option value="rCDI">rCDI</option>
                </select>
            </div>

            <!-- MGE Group Filter -->
            <div class="col-md-4 col-lg-2">
                <label for="mgeGroupFilter" class="form-label"><strong>MGE Group</strong></label>
                <select id="mgeGroupFilter" class="form-select">
                    <option value="all" selected>All Groups</option>
                    <!-- Options will be populated by JavaScript -->
                </select>
            </div>

            <!-- Timepoint Filter -->
            <div class="col-md-4 col-lg-2 dropdown">
                <label class="form-label"><strong>Patient Stages</strong></label>
                <button class="btn btn-light dropdown-toggle w-100 text-start" type="button"
                        id="timepointFilter" data-bs-toggle="dropdown" data-bs-auto-close="outside"
                        aria-expanded="false">
                    All Stages
                </button>
                <ul class="dropdown-menu p-2" aria-labelledby="timepointFilter"
                    style="max-height: 240px; overflow-y: auto;">
                    <li><label class="dropdown-item"><input type="checkbox" class="me-2 timepoint-checkbox" value="donor" checked> Donor</label></li>
                    <li><label class="dropdown-item"><input type="checkbox" class="me-2 timepoint-checkbox" value="pre" checked> Pre-FMT</label></li>
                    <li><label class="dropdown-item"><input type="checkbox" class="me-2 timepoint-checkbox" value="post1" checked> Post-FMT (1–30 d)</label></li>
                    <li><label class="dropdown-item"><input type="checkbox" class="me-2 timepoint-checkbox" value="post2" checked> Post-FMT (31–60 d)</label></li>
                    <li><label class="dropdown-item"><input type="checkbox" class="me-2 timepoint-checkbox" value="post3" checked> Post-FMT (61+ d)</label></li>
                </ul>
                </div>

            <!-- Search by Label -->
            <div class="col-md-4 col-lg-1">
                <label for="argSearch" class="form-label"><strong>Search ARGs</strong></label>
                <input type="text" id="argSearch" class="form-control" placeholder="">
            </div>

            <div class="col-md-4 col-lg-1">
                <label for="mgeSearch" class="form-label"><strong>Search MGEs</strong></label>
                <input type="text" id="mgeSearch" class="form-control" placeholder="">
            </div>
            
            <div class="col-md-4 col-lg-1">
                <button type="button" class="btn btn-outline-dark" type="button" id="resetBtn">Reset</button>
            </div>
            
             <!-- Display Toggles -->
            <div class="col-12">
                <div class="d-flex align-items-center gap-3 mt-2">
                    <strong>Display Toggles:</strong>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="toggleLabels" checked>
                        <label class="form-check-label" for="toggleLabels">Labels</label>
                    </div>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="toggleColo" checked>
                        <label class="form-check-label" for="toggleColo">Colocalization Links</label>
                    </div>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="toggleTemporal" checked>
                        <label class="form-check-label" for="toggleTemporal">Temporal Links</label>
                    </div>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="toggleLegend">
                        <label class="form-check-label" for="toggleLegend">Legend</label>
                    </div>
                    <div class="col-md-4 col-lg-2 d-flex align-items-end">
                        <button class="btn btn-outline-dark" type="button" id="downloadSvgBtn">
                         Download
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="graph-container">
        <svg id="graph" viewBox="0 0 1000 1000" preserveAspectRatio="xMidYMid meet"></svg>
    </div>

    <div id="legendOverlay" class="legend-overlay">
    <div class="legend-content">
        <button type="button" class="btn-close legend-close" aria-label="Close"></button>
        <h6 class="mb-3"><strong>Graph Legend</strong></h6>

        <!-- Node section -->
        <div class="legend-section">
        <p><strong>Nodes:</strong></p>
        <ul>
            <li><span class="legend-symbol arg"></span> AMR (Antimicrobial Resistance Gene)</li>
            <li><span class="legend-symbol donor"></span> Donor Sample</li>
            <li><span class="legend-symbol pre"></span> Pre-FMT</li>
            <li><span class="legend-symbol post1"></span> Post-FMT (1–30 d)</li>
            <li><span class="legend-symbol post2"></span> Post-FMT (31–60 d)</li>
            <li><span class="legend-symbol post3"></span> Post-FMT (61+ d)</li>
        </ul>
        </div>

        <!-- MGE group section -->
        <div class="legend-section mt-3">
        <p><strong>MGE Groups (Shapes):</strong></p>
        <ul>
            <li><span class="legend-shape plasmid"></span> Plasmid</li>
            <li><span class="legend-shape plasmid"></span> Inc_plasmid</li>
            <li><span class="legend-shape plasmid"></span> Colicin_plasmid</li>
            <li><span class="legend-shape prophage"></span> Prophage</li>
            <li><span class="legend-shape prophage"></span> ICE</li>
            <li><span class="legend-shape transposon"></span> Replicon</li>
            <li><span class="legend-shape genomic-island"></span> Likely IS/TE</li>
            <li><span class="legend-shape virus"></span> Virus</li>
        </ul>
        </div>

        <!-- Edge section -->
        <div class="legend-section mt-3">
        <p><strong>Edges:</strong></p>
        <ul>
            <li><span class="legend-line colo"></span> Colocalization Link (ARG–MGE)</li>
            <li><span class="legend-line temporal"></span> Temporal Link (same ARG/MGE across timepoints)</li>
        </ul>
        </div>

        <div class="legend-section mt-3">
        <p><strong>Temporal Edges:</strong></p>
        <ul>
            <li><span class="legend-line temporal-donor-pre"></span> Donor -> PreFMT</li>
            <li><span class="legend-line temporal-donor-post"></span> Donor -> PostFMT</li>
            <li><span class="legend-line temporal-pre-post"></span> PreFMT -> PostFMT</li>
            <li><span class="legend-line temporal-post-post"></span> PostFMT -> PostFMT</li>
        </ul>
        </div>
    </div>
    </div>


    
    <div id="tooltip" style="position:absolute; background:rgba(255,255,255,0.9); border:1px solid #ccc; padding:4px 8px; border-radius:4px; pointer-events:none; font-size:12px; display:none;"></div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
<script src="assets/js/graph.js"></script>
<script type="module" src="./assets/js/site.js"></script>

</body>
</html>
